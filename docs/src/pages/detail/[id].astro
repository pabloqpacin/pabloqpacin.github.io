---
interface Movie {
  type: any;
}

import Layout from "@layouts/Layout.astro";

const { id } = Astro.params;

const response = await fetch('https://api.themoviedb.org/3/movie/'+id+'?language=en-US', {
  method: 'GET',
  headers: {
    accept: 'application/json',
    Authorization: 'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiJiZDFhNzVmMjkxMGJhNDc2NzM3YjMxMDg1MTE2MWY4ZiIsIm5iZiI6MTcyNTAzMTg5Mi41MzgxNjQsInN1YiI6IjY2ZDFkZTE0ZjMwYTdiM2M4MDAzYmU0YSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.ebjwmy99VSLbKFMGStz8TckQj6axMFQZzJhhXyZA67Q'
  }
});
const data = await response.json();
// console.log(data);

const poster_url = "https://image.tmdb.org/t/p/w500";

// Trailer
const fetchVideo = await fetch('https://api.themoviedb.org/3/movie/'+id+'/videos?language=en-US', {
  method: 'GET',
  headers: {
    accept: 'application/json',
    Authorization: 'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiJiZDFhNzVmMjkxMGJhNDc2NzM3YjMxMDg1MTE2MWY4ZiIsIm5iZiI6MTcyNTAzMTg5Mi41MzgxNjQsInN1YiI6IjY2ZDFkZTE0ZjMwYTdiM2M4MDAzYmU0YSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.ebjwmy99VSLbKFMGStz8TckQj6axMFQZzJhhXyZA67Q'
  }
});
const trailer = await fetchVideo.json();
const res = trailer.results.filter((p: Movie) => p.type === "Trailer");
const video = res[0];
const youtube = "https://youtube.com/embed/"

---

<Layout>
    <div class="row mt-5">
        <div class="col-md-4">
            <img class="img-fluid rounded-start" src={ poster_url + data.poster_path} alt="poster"/>
        </div>
        <div class="col-md-8">
            <h1><span class="badge text-bg-dark">{ data.title }</span></h1>
            <h4>{ data.tagline }</h4>
            <h2>Overview</h2>
            <p>{ data.overview }</p>
            <p><span class="badge text-bg-secondary">{ data.release_date }</span></p>
            <h1><span class="badge text-bg-danger ms-2">{ Math.round(data.vote_average) }</span></h1>
        </div>
    </div>

    <hr>
    <br>
    <h1>Trailer</h1>
    <iframe src={ youtube+video.key } width="1280" height="720" frameborder="0" allowfullscreen></iframe>
</Layout>